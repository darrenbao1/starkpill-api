// !: A check was manually added to the first migration to ensure that the metadata table has only 1 row
generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Should only have 1 row
model metadata {
  id           Int @id @default(1)
  lastIndexed  Int // will return a still indexing error if more than 5 blocks behind the currentBlock
  currentBlock Int // get starting currentBlock from infura, otherwise start from lastIndexed
}

// 3 types of trxn: mint transfer, change attribute
// !: The values are used in the type IndexBlockData so if this is changed, that needs to be changed as well
enum EventType {
  MINT
  TRANSFER
  CHANGE_ATTRIBUTE
}

model Event {
  transactionHash String    @id
  to              String // the address of the user, mint to or transfer to address, or the address changing attributes
  tokenId         Int
  blockNumber     Int
  timestamp       DateTime
  eventType       EventType

  Mint            Mint?
  ChangeAttribute ChangeAttribute?
  Transfer        Transfer?
}

model Mint {
  transactionHash String @id
  combinedEvent   Event  @relation(fields: [transactionHash], references: [transactionHash])
  mintPrice       Int
  background      String
  ingredient      String
}

model ChangeAttribute {
  transactionHash String @id
  combinedEvent   Event  @relation(fields: [transactionHash], references: [transactionHash])
  oldBackground   String
  oldIngredient   String
  newBackground   String
  newIngredient   String
}

model Transfer {
  transactionHash String @id
  combinedEvent   Event  @relation(fields: [transactionHash], references: [transactionHash])
  from            String
  to              String
}
